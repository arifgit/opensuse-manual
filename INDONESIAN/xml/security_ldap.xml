<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd">
<!--
*********************************
Please see LICENSE.txt for this document's license.
*********************************
-->
<chapter xml:base="security_ldap.xml" id="cha.security.ldap">
 <title>LDAP—A Directory Service</title>
 
 <indexterm id="idx.LDAP" class="startofrange">
 <primary>LDAP</primary></indexterm><indexterm>
 <primary>Lightweight Directory Access Protocol</primary>
 <see>LDAP</see></indexterm><indexterm>
 <primary>protocols</primary>
 <secondary>LDAP</secondary></indexterm><indexterm>
 <primary>OpenLDAP</primary>
 <see>LDAP</see></indexterm>
 <abstract>
  <para>
   The Lightweight Directory Access Protocol (LDAP) is a set of protocols
   designed to access and maintain information directories. LDAP can be used
   for user and group management, system configuration management, address
   management, and more. This chapter provides a basic understanding of how
   OpenLDAP works and how to manage LDAP data with YaST.
  </para>
 </abstract>
 <para>
  In a network environment it is crucial to keep important information
  structured and to serve it quickly. A directory service—like the
  common yellow pages, keeps information available in a well-structured and
  readily-searchable form.
 </para>
 <para>
  Ideally, a central server stores the data in a directory and distributes
  it to all clients using a well-defined protocol. The structured data allow
  a wide range of applications to access them. A central repository reduces
  the necessary administrative effort. The use of an open and standardized
  protocol like LDAP ensures that as many different client applications as
  possible can access such information.
 </para>
 <para>
  A directory in this context is a type of database optimized for quick and
  effective reading and searching:
 </para>
 <itemizedlist mark="bullet" spacing="normal">
  <listitem>
   
   <para>
    To make multiple concurrent reading accesses possible, the number of
    updates is usually very low. The number of read and write accesses is
    often limited to a few users with administrative privileges. In
    contrast, conventional databases are optimized for accepting the largest
    possible data volume in a short time.
   </para>
  </listitem>
  <listitem>
   <para>
    When static data is administered, updates of the existing data sets are
    very rare. When working with dynamic data, especially when data sets
    like bank accounts or accounting are concerned, the consistency of the
    data is of primary importance. If an amount should be subtracted from
    one place to be added to another, both operations must happen
    concurrently, within one <emphasis>transaction</emphasis>, to ensure
    balance over the data stock. Traditional relational databases usually
    have a very strong focus on data consistency, such as the referential
    integrity support of transactions. Conversely, short-term
    inconsistencies are usually acceptable in LDAP directories. LDAP
    directories often do not have such strong consistency requirements as
    relational databases.
   </para>
  </listitem>
 </itemizedlist>
 <para>
  The design of a directory service like LDAP is not laid out to support
  complex update or query mechanisms. All applications are guaranteed to
  access this service quickly and easily.
 </para>
 <sect1 id="sec.security.ldap.vs_nis">
  <title>LDAP versus NIS</title>

  

  <para>
   Unix system administrators traditionally use NIS (Network Information
   Service) for name resolution and data distribution in a network. The
   configuration data contained in the files <filename>group</filename>,
   <filename>hosts</filename>, <filename>mail</filename>,
   <filename>netgroup</filename>, <filename>networks</filename>,
   <filename>passwd</filename>, <filename>printcap</filename>,
   <filename>protocols</filename>, <filename>rpc</filename>, and
   <filename>services</filename> in the <filename>/etc</filename> directory
   is distributed to clients all over the network. These files can be
   maintained without major effort because they are simple text files. The
   handling of larger amounts of data, however, becomes increasingly
   difficult due to nonexistent structuring. NIS is only designed for Unix
   platforms, and is not suitable as a centralized data administration tool
   in heterogeneous networks.
  </para>

  <para>
   Unlike NIS, the LDAP service is not restricted to pure Unix networks.
   Windows servers (from 2000) support LDAP as a directory service. The
   application tasks mentioned above are additionally supported in non-Unix
   systems.
  </para>

  <para>
   The LDAP principle can be applied to any data structure that needs to be
   centrally administered. A few application examples are:
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     Replacement for the NIS service
    </para>
   </listitem>
   <listitem>
    <para>
     Mail routing (postfix, sendmail)
    </para>
   </listitem>
   <listitem>
    <para>
     Address books for mail clients, like Mozilla, Evolution, and Outlook
    </para>
   </listitem>
   <listitem>
    <para>
     Administration of zone descriptions for a BIND9 name server
    </para>
   </listitem>
   <listitem>
    <para>
     User authentication with Samba in heterogeneous networks
    </para>
   </listitem>
  </itemizedlist>

  <para>
   This list can be extended because LDAP is extensible, unlike NIS. The
   clearly-defined hierarchical structure of the data eases the
   administration of large amounts of data, as it can be searched more
   easily.
  </para>
 </sect1>
 <sect1 id="sec.security.ldap.tree">
  <title>Structure of an LDAP Directory Tree</title><indexterm>

  <primary>LDAP</primary>

  <secondary>directory tree</secondary></indexterm>

  <para>
   To get background knowledge on how a LDAP server works and how the data
   is stored, it is vital to understand the way the data is organized on the
   server and how this structure enables LDAP to provide fast access to the
   data. To successfully operate an LDAP setup, you also need to be familiar
   with some basic LDAP terminology. This section introduces the basic
   layout of an LDAP directory tree and provides the basic terminology used
   with respect to LDAP. Skip this introductory section if you already have
   some LDAP background knowledge and just want to learn how to set up an
   LDAP environment in <phrase os="osuse">openSUSE</phrase>.<phrase os="sles;osuse"> Read on at
   <xref linkend="sec.security.ldap.yast"/> or
   <xref linkend="sec.security.ldap.slapd"/>.</phrase>
  </para>

  <para>
   An LDAP directory has a tree structure. All entries (called objects) of
   the directory have a defined position within this hierarchy. This
   hierarchy is called the <emphasis>directory information tree</emphasis>
   (DIT). The complete path to the desired entry, which unambiguously
   identifies it, is called the <emphasis>distinguished name</emphasis> or
   DN. A single node along the path to this entry is called
   <emphasis>relative distinguished name</emphasis> or RDN.
  </para>



  <para>
   The relations within an LDAP directory tree become more evident in the
   following example, shown in <xref linkend="fig.ldap.tree"/>.
  </para>

  <figure id="fig.ldap.tree">
   <title>Structure of an LDAP Directory</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="ldap_tree.svg" width="85%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="ldap_tree.png" width="85%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   The complete diagram is a fictional directory information tree. The
   entries on three levels are depicted. Each entry corresponds to one box
   in the image. The complete, valid <emphasis>distinguished name</emphasis>
   for the fictional employee <systemitem class="username">Geeko
   Linux</systemitem>, in this case, is <literal>cn=Geeko
   Linux,ou=doc,dc=example,dc=com</literal>. It is composed by adding the
   RDN <literal>cn=Geeko Linux</literal> to the DN of the preceding entry
   <literal>ou=doc,dc=example,dc=com</literal>.
  </para>



  <para>
   The types of objects that can be stored in the DIT are globally
   determined following a <emphasis>Schema</emphasis>. The type of an object
   is determined by the <emphasis>object class</emphasis>. The object class
   determines what attributes the relevant object must or can be assigned.
   The Schema, therefore, must contain definitions of all object classes and
   attributes used in the desired application scenario. There are a few
   common Schemas (see RFC 2252 and 2256). The LDAP RFC defines a few
   commonly used Schemas (see e.g., RFC4519). Additionally there are Schemas
   available for many other use cases (e.g., Samba, NIS replacement, etc.).
   It is, however, possible to create custom Schemas or to use multiple
   Schemas complementing each other (if this is required by the environment
   in which the LDAP server should operate).
  </para>

  <para>
   <xref linkend="tab.ldap.schema"/> offers a small overview of the object
   classes from <filename>core.schema</filename> and
   <filename>inetorgperson.schema</filename> used in the example, including
   required attributes (Req. Attr.) and valid attribute values.
   
  </para>

  <table id="tab.ldap.schema">
   <title>Commonly Used Object Classes and Attributes</title>
   <tgroup cols="4">
    <colspec colname="c1" colwidth="30*"/>
    <colspec colname="c2" colwidth="40*"/>
    <colspec colname="c3" colwidth="16*"/>
    <colspec colname="c4" colwidth="14*"/>
    <thead>
     <row>
      <entry>
       <para>
        Object Class
       </para>
      </entry>
      <entry>
       <para>
        Meaning
       </para>
      </entry>
      <entry>
       <para>
        Example Entry
       </para>
      </entry>
      <entry>
       <para>
        Req. Attr.
       </para>
      </entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>
       <para>
        <literal>dcObject</literal>
       </para>
      </entry>
      <entry>
       <para>
        <emphasis>domainComponent</emphasis> (name components of the domain)
       </para>
      </entry>
      <entry>
       <para>
        example
       </para>
      </entry>
      <entry>
       <para>
        dc
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <literal>organizationalUnit</literal>
       </para>
      </entry>
      <entry>
       <para>
        <emphasis>organizationalUnit</emphasis> (organizational unit)
       </para>
      </entry>
      <entry>
       <para>
        doc
       </para>
      </entry>
      <entry>
       <para>
        ou
       </para>
      </entry>
     </row>
     <row>
      <entry>
       <para>
        <literal>inetOrgPerson</literal>
       </para>
      </entry>
      <entry>
       <para>
        <emphasis>inetOrgPerson</emphasis> (person-related data for the
        intranet or Internet)
       </para>
      </entry>
      <entry>
       <para>
        Geeko Linux
       </para>
      </entry>
      <entry>
       <para>
        sn and cn
       </para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </table>

  <para>
   <xref linkend="aus.ldap.schema.help"/> shows an excerpt from a Schema
   directive with explanations.
  </para>

  <example id="aus.ldap.schema.help">
   <title>Excerpt from schema.core</title>
<screen>attributetype (2.5.4.11 NAME ( 'ou' 'organizationalUnitName') <co id="co.ldap.schema.core.att_type"/>
       DESC 'RFC2256: organizational unit this object belongs to' <co id="co.ldap.schema.core.desc"/>
       SUP name ) <co id="co.ldap.schema.core.sup"/>

objectclass ( 2.5.6.5 NAME 'organizationalUnit' <co id="co.ldap.schema.core.oc"/>
       DESC 'RFC2256: an organizational unit' <co id="co.ldap.schema.core.desc.oc"/>
       SUP top STRUCTURAL <co id="co.ldap.schema.core.sup.oc"/>
       MUST ou <co id="co.ldap.schema.core.must.oc"/>
MAY (userPassword $ searchGuide $ seeAlso $ businessCategory <co id="co.ldap.schema.core.may.oc"/>
  $ x121Address $ registeredAddress $ destinationIndicator 
  $ preferredDeliveryMethod $ telexNumber 
  $ teletexTerminalIdentifier $ telephoneNumber 
  $ internationaliSDNNumber $ facsimileTelephoneNumber 
  $ street $ postOfficeBox $ postalCode $ postalAddress 
  $ physicalDeliveryOfficeName
  $ st $ l $ description) )
  ...</screen>
  </example>

  <para>
   The attribute type <literal>organizationalUnitName</literal> and the
   corresponding object class <literal>organizationalUnit</literal> serve as
   an example here.
  </para>

  <calloutlist>
   <callout arearefs="co.ldap.schema.core.att_type">
    <para>
     The name of the attribute, its unique OID (<emphasis>object
     identifier</emphasis>) (numerical), and the abbreviation of the
     attribute.
    </para>
   </callout>
   <callout arearefs="co.ldap.schema.core.desc">
    <para>
     A brief description of the attribute with <literal>DESC</literal>. The
     corresponding RFC, on which the definition is based, is also mentioned
     here.
    </para>
   </callout>
   <callout arearefs="co.ldap.schema.core.sup">
    <para>
     <literal>SUP</literal> indicates a superordinate attribute type to
     which this attribute belongs.
    </para>
   </callout>
   <callout arearefs="co.ldap.schema.core.oc">
    <para>
     The definition of the object class
     <literal>organizationalUnit</literal> begins—the same as in the
     definition of the attribute—with an OID and the name of the
     object class.
    </para>
   </callout>
   <callout arearefs="co.ldap.schema.core.desc.oc">
    <para>
     A brief description of the object class.
    </para>
   </callout>
   <callout arearefs="co.ldap.schema.core.sup.oc">
    <para>
     The <literal>SUP top</literal> entry indicates that this object class
     is not subordinate to another object class.
    </para>
   </callout>
   <callout arearefs="co.ldap.schema.core.must.oc">
    <para>
     With <literal>MUST</literal> list all attribute types that must be used
     in conjunction with an object of the type
     <literal>organizationalUnit</literal>.
    </para>
   </callout>
   <callout arearefs="co.ldap.schema.core.may.oc">
    <para>
     With <literal>MAY</literal> list all attribute types that are permitted
     in conjunction with this object class.
    </para>
   </callout>
  </calloutlist>

  <para>
   A very good introduction to the use of Schemas can be found in the
   OpenLDAP documentation (<systemitem>openldap2-doc</systemitem>). When
   installed, find it in
   <filename>/usr/share/doc/packages/openldap2/adminguide/guide.html</filename>.
  </para>
 </sect1>
 <sect1 id="sec.security.ldap.yast" os="osuse;sles">
  <title>Configuring an LDAP Server with YaST</title><indexterm>

  <primary>LDAP</primary>

  <secondary>configuring</secondary>

  <tertiary>YaST</tertiary></indexterm><indexterm>

  <primary>YaST</primary>

  <secondary>LDAP</secondary>

  <tertiary>servers</tertiary></indexterm><indexterm>

  <primary>LDAP</primary>

  <secondary>server configuration</secondary>

  <tertiary>YaST</tertiary></indexterm>

  <para>
   Use YaST to set up an LDAP server. Typical use cases for LDAP servers
   include the management of user account data and the configuration of
   mail, DNS, and DHCP servers.
  </para>

  <figure id="fig.ldap.y2.wizard.general.settings">
   <title>YaST LDAP Server Configuration</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="yast2_ldap_wizard_general_settings.png" width="75%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="yast2_ldap_wizard_general_settings.png" width="75%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <figure id="fig.ldap.y2.wizard.db.settings">
   <title>YaST LDAP Server—New Database</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="yast2_ldap_wizard_db_settings.png" width="75%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="yast2_ldap_wizard_db_settings.png" width="75%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   To set up an LDAP server for user account data, make sure the
   <systemitem>yast2-ldap-server</systemitem> and
   <systemitem>openldap2</systemitem> packages are installed. Then proceed
   as follows:
  </para>

  <procedure>
   <step performance="required">
    <para>
     Start YaST as <systemitem class="username">root</systemitem> and select <menuchoice> <guimenu>Network
     Services</guimenu> <guimenu>LDAP Server</guimenu> </menuchoice> to
     invoke the configuration wizard.
    </para>
   </step>
   <step performance="required">
    <para>
     Configure the <guimenu>Global Settings</guimenu> of your LDAP server
     (you can change these settings later)—see
     <xref linkend="fig.ldap.y2.wizard.general.settings"/>:
    </para>
    <substeps performance="required">
     <step performance="required">
      <para>
       Set LDAP to be started.
      </para>
     </step>
     <step performance="required">
      <para>
       If the LDAP server should announce its services via SLP, check
       <guimenu>Register at an SLP Daemon</guimenu>.
      </para>
     </step>
     <step performance="required">
      <para>
       Configure <guimenu>Firewall Settings</guimenu>.
      </para>
     </step>
     <step performance="required">
      <para>
       Click <guimenu>Next</guimenu>.
      </para>
     </step>
    </substeps>
   </step>
   <step performance="required">
    <para>
     Select the server type: stand-alone server, master server in a
     replication setup, or replication (slave) server.
    </para>
   </step>
   <step performance="required">
    <para>
     Select security options (<guimenu>TLS Settings</guimenu>).
    </para>
    <para>
     It is strongly recommended to <guimenu>Enable TLS</guimenu>. For more
     information, see <xref linkend="step.ldap.server.config.tls"/>.
    </para>
    <warning>
     <title>Password Encryption</title>
     <para>
      Enabling TLS ensures passwords are sent encrypted over the network.
      When this option is not enabled, passwords are sent unencrypted.
     </para>
    </warning>
    <para>
     Also consider to use LDAP over SSL and certificates.
    </para>
   </step>
   <step performance="required">
    <para>
     Confirm <guimenu>Basic Database Settings</guimenu> with entering an
     <guimenu>LDAP Administrator Password</guimenu> and then clicking
     <guimenu>Next</guimenu>—see
     <xref linkend="fig.ldap.y2.wizard.db.settings"/>.
    </para>
   </step>
   <step performance="required">
    <para>
     Check the <guimenu>LDAP Server Configuration Summary</guimenu> and
     click <guimenu>Finish</guimenu> to exit the configuration wizard.
    </para>
   </step>
  </procedure>

  <figure id="fig.ldap.y2.server.cfg">
   <title>YaST LDAP Server Configuration</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="yast2_ldap_server_cfg.png" width="75%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="yast2_ldap_server_cfg.png" width="75%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   For changes or additional configuration start the LDAP server module
   again and in the left pane expand <guimenu>Global Settings</guimenu> to
   make subentries visible—see
   <xref linkend="fig.ldap.y2.server.cfg"/>:
  </para>

  <procedure>
   <step performance="required">
    <para>
     With <guimenu>Log Level Settings</guimenu>, configure the degree of
     logging activity (verbosity) of the LDAP server. From the predefined
     list, select or deselect the logging options according to your needs.
     The more options are enabled, the larger your log files grow.
    </para>
   </step>
   <step performance="required">
    <para>
     Configure which connection types the server should offer under
     <guimenu>Allow/Disallow Features</guimenu>. Choose from:
    </para>
    <variablelist>
     <varlistentry>
      <term>LDAPv2 Bind Requests</term>
      <listitem>
       <para>
        This option enables connection requests (bind requests) from clients
        using the previous version of the protocol (LDAPv2).
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Anonymous Bind When Credentials Not Empty</term>
      <listitem>
       <para>
        Normally the LDAP server denies any authentication attempts with
        empty credentials (DN or password). Enabling this option, however,
        makes it possible to connect with a password and no DN to establish
        an anonymous connection.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Unauthenticated Bind When DN Not Empty</term>
      <listitem>
       <para>
        Enabling this option makes it possible to connect without
        authentication (anonymously) using a DN but no password.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Unauthenticated Update Options to Process</term>
      <listitem>
       <para>
        Enabling this option allows non-authenticated (anonymous) update
        operations. Access is restricted according to ACLs and other rules.

       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </step>
   <step performance="required">
    <para>
     <guimenu>Allow/Disallow Features</guimenu> also lets you configure the
     server flags. Choose from:
    </para>
    <variablelist>
     <varlistentry>
      <term>Disable Acceptance of Anonymous Bind Requests</term>
      <listitem>
       <para>
        The server will no longer accept anonymous bind requests. Note, that
        this does not generally prohibit anonymous directory access.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Disable Simple Bind Authentication</term>
      <listitem>
       <para>
        Completely disable Simple Bind authentication.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Disable Forcing Session to Anonymous Status upon StartTLS Operation Receipt</term>
      <listitem>
       <para>
        The server will no longer force an authenticated connection back to
        the anonymous state when receiving the StartTLS operation.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Disallow the StartTLS Operation if Authenticated</term>
      <listitem>
       <para>
        The server will disallow the StartTLS operation on already
        authenticated connections.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </step>
   <step id="step.ldap.server.config.tls" performance="required">
    <para>
     To configure secure communication between client and server, proceed
     with <guimenu>TLS Settings</guimenu>:
    </para>
    <substeps performance="required">
     <step performance="required">
      <para>
       Activate <guimenu>Enable TLS</guimenu> to enable TLS and SSL
       encryption of the client/server communication.
      </para>
     </step>
     <step performance="required">
      <para>
       Either <guimenu>Import Certificate</guimenu> by specifying the exact
       path to its location or enable the <guimenu>Use Common Server
       Certificate</guimenu>. If the <guimenu>Use Common Server
       Certificate</guimenu> is not available because it has not been
       created during installation, go for <guimenu>Launch CA Management
       Module</guimenu> first— for more information, see
       <xref linkend="sec.security.yast_ca.module"/>.
      </para>

     </step>
    </substeps>
   </step>
  </procedure>

  <para>


   Add Schema files to be included in the server's configuration by
   selecting <guimenu>Schema Files</guimenu> in the left part of the dialog.
   The default selection of schema files applies to the server providing a
   source of YaST user account data.
  </para>

  <para>
   YaST allows to add traditional Schema files (usually with a name ending
   in <literal>.schema</literal>) or LDIF files containing Schema
   definitions in OpenLDAP's LDIF Schema format.
  </para>

  <figure id="fig.ldap.y2.server.db.cfg">
   <title>YaST LDAP Server Database Configuration</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="yast2_ldap_server_db_cfg.png" width="75%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="yast2_ldap_server_db_cfg.png" width="75%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   To configure the databases managed by your LDAP server, proceed as
   follows:
  </para>

  <procedure>
   <step performance="required">
    <para>
     Select the <guimenu>Databases</guimenu> item in the left part of the
     dialog.
    </para>
   </step>
   <step performance="required">
    <para>
     Click <guimenu>Add Database</guimenu> to add a new database.
    </para>
   </step>
   <step performance="required">
    <para>
     Enter the requested data:
    </para>
    <variablelist>
     <varlistentry>
      <term><guimenu>Base DN</guimenu>
      </term>
      <listitem>
       <para>
        Enter the base DN of your LDAP server.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>Administrator DN</guimenu>
      </term>
      <listitem>
       <para>
        Enter the DN of the administrator in charge of the server. If you
        check <guimenu>Append Base DN</guimenu>, only provide the
        <literal>cn</literal> of the administrator and the system fills in
        the rest automatically.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>LDAP Administrator Password</term>
      <listitem>
       <para>
        Enter the password for the database administrator.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Use This Database as the Default for OpenLDAP Clients</term>
      <listitem>
       <para>
        For convenience, check this option if wanted.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </step>
   <step performance="required">
    <para>
     In the next dialog configure replication settings.
    </para>
   </step>

   <step performance="required">
    <para>
     In the next dialog, enable enforcement of password policies to provide
     extra security to your LDAP server:
    </para>
    <substeps performance="required">
     <step performance="required">
      <para>
       Check <guimenu>Enable Password Policies</guimenu> to be able to
       specify a password policy.
      </para>
     </step>
     <step performance="required">
      <para>
       Activate <guimenu>Hash Clear Text Passwords</guimenu> to have clear
       text passwords be hashed before they are written to the database
       whenever they are added or modified.
      </para>
     </step>
     <step performance="required">
      <para>
       <guimenu>Disclose "Account Locked" Status</guimenu> provides a
       relevant error message for bind requests to locked accounts.
      </para>
      <warning>
       <title>Locked Accounts in Security Sensitive Environments</title>
       <para>
        Do not use the <guimenu>Disclose "Account Locked" Status</guimenu>
        option if your environment is sensitive to security issues, because
        the <quote>Locked Account</quote> error message provides
        security-sensitive information that can be exploited by a potential
        attacker.
       </para>
      </warning>
     </step>
     <step performance="required">
      <para>
       Enter the DN of the default policy object. To use a DN other than the
       one suggested by YaST, enter your choice. Otherwise, accept the
       default settings.
      </para>
     </step>
    </substeps>
   </step>
   <step performance="required">
    <para>
     Complete the database configuration by clicking
     <guimenu>Finish</guimenu>.
    </para>
   </step>
  </procedure>

  <para>
   If you have not opted for password policies, your server is ready to run
   at this point. If you have chosen to enable password policies, proceed
   with the configuration of the password policy in detail. If you have
   chosen a password policy object that does not yet exist, YaST creates
   one:
  </para>

  <procedure>
   <step performance="required">
    <para>
     Enter the LDAP server password. In the navigation tree below
     <guimenu>Databases</guimenu> expand your database object and activate
     the <guimenu>Password Policy Configuration</guimenu> item.
    </para>
   </step>
   <step performance="required">
    <para>
     Make sure <guimenu>Enable Password Policies</guimenu> is activated.
     Then click <guimenu>Edit Policy</guimenu>.
    </para>
   </step>
   <step performance="required">
    <para>
     Configure the password change policies:
    </para>
    <substeps performance="required">
     <step performance="required">
      <para>
       Determine the number of passwords stored in the password history.
       Saved passwords may not be reused by the user.
      </para>
     </step>
     <step performance="required">
      <para>
       Determine if users will be able to change their passwords and if they
       will need to change their passwords after a reset by the
       administrator. Require the old password for password changes
       (optional).
      </para>
     </step>
     <step performance="required">
      <para>
       Determine whether and to what extent passwords should be subject to
       quality checking. Set the minimum password length that must be met
       before a password is valid. If you select <guimenu>Accept Uncheckable
       Passwords</guimenu>, users are allowed to use encrypted passwords,
       even though the quality checks cannot be performed. If you opt for
       <guimenu>Only Accept Checked Passwords</guimenu> only those passwords
       that pass the quality tests are accepted as valid.
      </para>
     </step>
    </substeps>
   </step>
   <step performance="required">
    <para>
     Configure the password time-limit policies:
    </para>
    <substeps performance="required">
     <step performance="required">
      <para>
       Determine the minimum password time-limit (the time that needs to
       pass between two valid password changes) and the maximum password
       time-limit.
      </para>
     </step>
     <step performance="required">
      <para>
       Determine the time between a password expiration warning and the
       actual password expiration.
      </para>
     </step>
     <step performance="required">
      <para>
       Set the number of postponement uses of an expired password before the
       password expires permanently.
      </para>
     </step>
    </substeps>
   </step>
   <step performance="required">
    <para>
     Configure the lockout policies:
    </para>
    <substeps performance="required">
     <step performance="required">
      <para>
       Enable password locking.
      </para>
     </step>
     <step performance="required">
      <para>
       Determine the number of bind failures that trigger a password lock.
      </para>
     </step>
     <step performance="required">
      <para>
       Determine the duration of the password lock.
      </para>
     </step>
     <step performance="required">
      <para>
       Determine the length of time that password failures are kept in the
       cache before they are purged.
      </para>
     </step>
    </substeps>
   </step>
   <step performance="required">
    <para>
     Apply your password policy settings with <guimenu>OK</guimenu>.
    </para>
   </step>
  </procedure>

  <para>
   To edit a previously created database, select its base DN in the tree to
   the left. In the right part of the window, YaST displays a dialog
   similar to the one used for the creation of a new database (with the main
   difference that the base DN entry is grayed out and cannot be changed).
  </para>

  <para>
   After leaving the LDAP server configuration by selecting
   <guimenu>Finish</guimenu>, you are ready to go with a basic working
   configuration for your LDAP server. To fine-tune this setup, make use of
   OpenLDAP's dynamic configuration backend.
  </para>

  <para>
   The OpenLDAP's dynamic configuration backend stores the configuration in
   an LDAP database. That database consists of a set of
   <literal>.ldif</literal> files in
   <filename>/etc/openldap/slapd.d</filename>. There is no need to access
   these files directly. To access the settings you can either use the
   YaST LDAP server module (the <systemitem>yast2-ldap-server</systemitem>
   package) or an LDAP client such as <command>ldapmodify</command> or
   <command>ldapsearch</command>. For more information on the dynamic
   configuration of OpenLDAP, see the OpenLDAP Administration Guide.
  </para>
 </sect1>
 <sect1 id="sec.security.ldap.yast.client">
  <title>Configuring an LDAP Client with YaST</title><indexterm>

  <primary>LDAP</primary>

  <secondary>YaST</secondary>

  <tertiary>client</tertiary></indexterm><indexterm>

  <primary>YaST</primary>

  <secondary>LDAP</secondary>

  <tertiary>clients</tertiary></indexterm><indexterm>

  <primary>LDAP</primary>

  <secondary>YaST</secondary>

  <tertiary>modules</tertiary></indexterm><indexterm>

  <primary>LDAP</primary>

  <secondary>YaST</secondary>

  <tertiary>templates</tertiary></indexterm>

  <para>
   YaST includes a module to set up LDAP-based user management. If you did
   not enable this feature during the installation, start the module by
   selecting <menuchoice> <guimenu>Network Services</guimenu> <guimenu>LDAP
   Client</guimenu> </menuchoice>. YaST automatically enables any PAM and
   NSS-related changes as required by LDAP and installs the necessary files.
   Simply connect your client to the server and let YaST manage users over
   LDAP. This basic setup is described in
   <xref linkend="sec.security.ldap.yast.client.conf.basic"/>.
  </para>

  <para>
   Use the YaST LDAP client to further configure the YaST group and user
   configuration modules. This includes manipulating the default settings
   for new users and groups and the number and nature of the attributes
   assigned to a user or group. LDAP user management allows you to assign
   far more and different attributes to users and groups than traditional
   user or group management solutions. This is described in
   <xref linkend="sec.security.ldap.yast.client.conf.mod"/>.
  </para>

  <sect2 id="sec.security.ldap.yast.client.conf.basic">
   <title>Configuring Basic Settings</title>
   <para>
    The basic LDAP client configuration dialog
    (<xref linkend="fig.ldap.y2.clconf"/>) opens during installation if you
    choose LDAP user management or when you select <menuchoice>
    <guimenu>Network Services</guimenu> <guimenu>LDAP Client</guimenu>
    </menuchoice> in the YaST Control Center in the installed system.
   </para>
   <figure id="fig.ldap.y2.clconf">
    <title>YaST: LDAP Client Configuration</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="ldap_y2_clconf.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="ldap_y2_clconf.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <procedure>
    <para>
     To authenticate users of your machine against an OpenLDAP server and to
     enable user management via OpenLDAP, proceed as follows:
    </para>
    <step performance="required">
     <para>
      Click <guimenu>Use LDAP</guimenu> to enable the use of LDAP. Select
      <guimenu>Use LDAP but Disable Logins</guimenu> instead if you want to
      use LDAP for authentication, but do not want other users to log in to
      this client.
     </para>
    </step>
    <step performance="required">
     <para>
      Enter the IP address of the LDAP server to use.
     </para>
    </step>
    <step performance="required">
     <para>
      Enter the <guimenu>LDAP Base DN</guimenu> to select the search base on
      the LDAP server. To retrieve the base DN automatically, click
      <guimenu>Fetch DN</guimenu>. YaST then checks for any LDAP database
      on the server address specified above. Choose the appropriate base DN
      from the search results given by YaST.
     </para>
    </step>
    <step performance="required">
     <para>
      If TLS or SSL-protected communication with the server is required,
      select <guimenu>LDAP TLS/SSL</guimenu>. Click <guimenu>Download CA
      Certificate</guimenu> to download a certificate in PEM format from a
      URL.
     </para>
    </step>
    <step performance="required">
     <para>
      Select <guimenu>Start Automounter</guimenu> to mount remote
      directories on your client, such as a remotely managed
      <filename>/home</filename>.
     </para>
    </step>
    <step performance="required">
     <para>
      Select <guimenu>Create Home Directory on Login</guimenu> to have a
      user's home automatically created on the first user login.
     </para>
    </step>
    <step performance="required">
     <para>
      Click <guimenu>OK</guimenu> to apply your settings.
     </para>
    </step>
   </procedure>
   <para>
    To modify data on the server as administrator, click <guimenu>Advanced
    Configuration</guimenu>. The following dialog is split into two tabs.
    See <xref linkend="fig.ldap.y2.adconf"/>.
   </para>
   <figure id="fig.ldap.y2.adconf">
    <title>YaST: Advanced Configuration</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="ldap_y2_adconf.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="ldap_y2_adconf.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <procedure>
    <step performance="required">
     <para>
      In the <guimenu>Client Settings</guimenu> tab, adjust the following
      settings according to your needs:
     </para>
     <substeps performance="required">
      <step performance="required">
       <para>
        If the search base for users, passwords, and groups differs from the
        global search base specified in the <guimenu>LDAP base DN</guimenu>,
        enter these different naming contexts in <guimenu>User
        Map</guimenu>, <guimenu>Password Map</guimenu>, and <guimenu>Group
        Map</guimenu>.
       </para>
      </step>
      <step performance="required">
       <para>
        Specify the password change protocol. The standard method to use
        whenever a password is changed is <systemitem>crypt</systemitem>,
        meaning that password hashes generated by <command>crypt</command>
        are used. For details on this and other options, refer to the
        <systemitem>pam_ldap</systemitem> man page.
       </para>
      </step>
      <step performance="required">
       <para>
        Specify the LDAP group to use with <guimenu>Group Member
        Attribute</guimenu>. The default value for this is
        <literal>member</literal>.
       </para>
      </step>
      <step performance="required">
       <para>
        If a secure connection requires certificate checking, specify where
        your <guimenu>CA Certificate File</guimenu> in PEM format is
        located. Or specify a directory with certificates.
       </para>
      </step>
      <step performance="required">
       <para>
        If the LDAP server still uses LDAPv2, enable the use of this
        protocol version by selecting <guimenu>LDAP Version 2</guimenu>.
       </para>
      </step>
     </substeps>
    </step>
    <step performance="required">
     <para>
      In <guimenu>Administration Settings</guimenu>, adjust the following
      settings:
     </para>
     <substeps performance="required">
      <step performance="required">
       <para>
        Set the base for storing your user management data via
        <guimenu>Configuration Base DN</guimenu>.
       </para>
      </step>
      <step performance="required">
       <para>
        Enter the appropriate value for <guimenu>Administrator DN</guimenu>.
        This DN must be identical with the <literal>rootdn</literal> value
        specified in <filename>/etc/openldap/slapd.conf</filename> to enable
        this particular user to manipulate data stored on the LDAP server.
        Enter the full DN (such as
        <literal>cn=Administrator,dc=example,dc=com</literal>) or activate
        <guimenu>Append Base DN</guimenu> to have the base DN added
        automatically when you enter <literal>cn=Administrator</literal>.
       </para>
      </step>
      <step performance="required">
       <para>
        Check <guimenu>Create Default Configuration Objects</guimenu> to
        create the basic configuration objects on the server to enable user
        management via LDAP.
       </para>
      </step>
      <step performance="required">
       <para>
        If your client machine needs to act as a file server for home
        directories across your network, check <guimenu>Home Directories on
        This Machine</guimenu>.
       </para>
      </step>
      <step performance="required">
       <para>
        Use the <guimenu>Password Policy</guimenu> section to select, add,
        delete, or modify the password policy settings to use. The
        configuration of password policies with YaST is part of the LDAP
        server setup.
       </para>
      </step>
      <step performance="required">
       <para>
        Click <guimenu>OK</guimenu> to leave the <guimenu>Advanced
        Configuration</guimenu>, then <guimenu>Finish</guimenu> to apply
        your settings.
       </para>
      </step>
     </substeps>
    </step>
   </procedure>
   <para>
    Use <guimenu>Configure User Management Settings</guimenu> to edit
    entries on the LDAP server. Access to the configuration modules on the
    server is then granted according to the ACLs and ACIs stored on the
    server. Follow the procedures outlined in
    <xref linkend="sec.security.ldap.yast.client.conf.mod"/>.
   </para>
  </sect2>

  <sect2 id="sec.security.ldap.yast.client.conf.mod">
   <title>Configuring the YaST Group and User Administration Modules</title>
   <para>
    Use the YaST LDAP client to adapt the YaST modules for user and
    group administration and to extend them as needed. Define templates with
    default values for the individual attributes to simplify the data
    registration. The presets created here are stored as LDAP objects in the
    LDAP directory. The registration of user data is still done with the
    regular YaST modules for user and group management. The registered
    data is stored as LDAP objects on the server.
   </para>
   <figure id="fig.ldap.y2.modconf1">
    <title>YaST: Module Configuration</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="ldap_y2_modconf1.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="ldap_y2_modconf1.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    The dialog for module configuration
    (<xref linkend="fig.ldap.y2.modconf1"/>) allows the creation of new
    modules, selection and modification of existing configuration modules,
    and design and modification of templates for such modules.
   </para>
   <procedure>
    <para>
     To create a new configuration module, proceed as follows:
    </para>
    <step performance="required">
     <para>
      In the <guimenu>LDAP Client Configuration</guimenu> click
      <guimenu>Advanced Configuration</guimenu>, then open the
      <guimenu>Administration Settings</guimenu> tab. Click
      <guimenu>Configure User Management Settings</guimenu> and enter the
      LDAP server credentials.
     </para>
    </step>
    <step performance="required">
     <para>
      Click <guimenu>New</guimenu> and select the type of module to create.
      For a user configuration module, select
      <literal>suseUserConfiguration</literal> and for a group configuration
      choose <literal>suseGroupConfiguration</literal>.
     </para>
    </step>
    <step performance="required">
     <para>
      Choose a name for the new template (e.g.,
      <literal>userConfig</literal>). The content view shows a table listing
      all attributes allowed in this module and their assigned values.
     </para>
    </step>
    <step performance="required">
     <para>
      Accept the preset values or adjust the defaults to use in group and
      user configurations by selecting the relevant attribute, pressing
      <guimenu>Edit</guimenu>, and entering the new value. Rename a module
      by changing the <systemitem>cn</systemitem> attribute of the module.
      Clicking <guimenu>Delete</guimenu> deletes the currently selected
      module.
     </para>
    </step>
    <step performance="required">
     <para>
      After you click <guimenu>OK</guimenu>, the new module is added to the
      selection menu.
     </para>
    </step>
   </procedure>
   <procedure>
    <para>
     The YaST modules for group and user administration embed templates
     with standard values. To edit a template associated with a
     configuration module, start the object template configuration
     (<xref linkend="fig.ldap.y2.objtemp"/>):
    </para>
    <step performance="required">
     <para>
      In the <guimenu>Module Configuration</guimenu> dialog, click
      <guimenu>Configure Template</guimenu>.
     </para>
    </step>
    <step performance="required">
     <para>
      Determine the values of the general attributes assigned to this
      template according to your needs or leave them empty. Empty attributes
      are deleted on the LDAP server.
     </para>
    </step>
    <step performance="required">
     <para>
      Modify, delete, or add new default values for new objects (user or
      group configuration objects in the LDAP tree).
     </para>
    </step>
   </procedure>
   <figure id="fig.ldap.y2.objtemp">
    <title>YaST: Configuration of an Object Template</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="ldap_y2_objtemp.png" width="75%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="ldap_y2_objtemp.png" width="75%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    Connect the template to its module by setting the
    <literal>susedefaulttemplate</literal> attribute value of the module to
    the DN of the adapted template.
   </para>
<?dbfo-need height="10em"?>

   <tip>
    <para>
     The default values for an attribute can be created from other
     attributes by using a variable instead of an absolute value. For
     example, when creating a new user, <literal>cn=%sn %givenName</literal>
     is created automatically from the attribute values for
     <literal>sn</literal> and <literal>givenName</literal>.
    </para>
   </tip>
   <para>
    Once all modules and templates are configured correctly and ready to
    run, new groups and users can be registered in the usual way with
    YaST.
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec.security.ldap.yast.usergr">
  <title>Configuring LDAP Users and Groups in YaST</title><indexterm>

  <primary>LDAP</primary>

  <secondary>administering users</secondary></indexterm><indexterm>

  <primary>LDAP</primary>

  <secondary>administering groups</secondary></indexterm>

  <para>
   The actual registration of user and group data differs only slightly from
   the procedure when not using LDAP. The following instructions relate to
   the administration of users. The procedure for administering groups is
   analogous.
  </para>



  <procedure>
   <step performance="required">
    <para>
     Access the YaST user administration with <menuchoice>
     <guimenu>Security and Users</guimenu><guimenu>User and Group
     Management</guimenu></menuchoice>.
    </para>
   </step>
   <step performance="required">
    <para>
     Use <guimenu>Set Filter</guimenu> to limit the view of users to the
     LDAP users and enter the password for Root DN.
    </para>
   </step>
   <step performance="required">
    <para>
     Click <guimenu>Add</guimenu> to enter the user configuration. A dialog
     with four tabs opens:
    </para>
    <substeps performance="required">
     <step performance="required">
      <para>
       Specify username, login, and password in the <guimenu>User
       Data</guimenu> tab.
      </para>
     </step>
     <step performance="required">
      <para>
       Check the <guimenu>Details</guimenu> tab for the group membership,
       login shell, and home directory of the new user. If necessary, change
       the default to values that better suit your needs. The default values
       (as well as those of the password settings) can be defined with the
       procedure described in
       <xref linkend="sec.security.ldap.yast.client.conf.mod"/>.
      </para>
     </step>
     <step performance="required">
      <para>
       Modify or accept the default <guimenu>Password Settings</guimenu>.
      </para>
     </step>
     <step performance="required">
      <para>
       Enter the <guimenu>Plug-Ins</guimenu> tab, select the LDAP plug-in,
       and click <guimenu>Launch</guimenu> to configure additional LDAP
       attributes assigned to the new user (see
       <xref linkend="fig.ldap.y2.adset"/>).
      </para>
     </step>
    </substeps>
   </step>
   <step performance="required">
    <para>
     Click <guimenu>OK</guimenu> to apply your settings and leave the user
     configuration.
    </para>
   </step>
  </procedure>

  <figure id="fig.ldap.y2.adset">
   <title>YaST: Additional LDAP Settings</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="ldap_y2_adset.png" width="75%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="ldap_y2_adset.png" width="75%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   The initial input form of user administration offers <guimenu>LDAP
   Options</guimenu>. This allows you to apply LDAP search filters to the
   set of available users. Alternatively open the module for configuring
   LDAP users and groups by selecting <guimenu>LDAP User and Group
   Configuration</guimenu>.
  </para>
 </sect1>
<?dbfo-need height="20em"?>

 <sect1 id="sec.security.ldap.browse">
  <title>Browsing the LDAP Directory Tree</title>

  <para>
   To conveniently browse the LDAP directory tree and all its entries, use
   the YaST LDAP Browser:
  </para>

  <procedure>
   <step performance="required">
    <para>
     Log in as <systemitem class="username">root</systemitem>.
    </para>
   </step>
   <step performance="required">
    <para>
     Start <menuchoice> <guimenu>YaST</guimenu> <guimenu>Network
     Services</guimenu> <guimenu>LDAP Browser</guimenu> </menuchoice>.
    </para>
   </step>
   <step performance="required">
    <para>
     Enter the address of the LDAP server, the Administrator DN, and the
     password for the Root DN of this server (if you need both to read and
     write the data stored on the server).
    </para>
    <para>
     Alternatively, choose <guimenu>Anonymous Access</guimenu> and do not
     provide the password to gain read access to the directory.
    </para>
    <para>
     The <guimenu>LDAP Tree</guimenu> tab displays the content of the LDAP
     directory to which your machine connected. Click to expand each item's
     submenu.
    </para>
    <figure id="fig.ldap.browsetree">
     <title>Browsing the LDAP Directory Tree</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="ldap_y2_browsetree.png" width="85%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="ldap_y2_browsetree.png" width="85%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step performance="required">
    <para>
     To view any entry in detail, select it in the <guimenu>LDAP
     Tree</guimenu> view and open the <guimenu>Entry Data</guimenu> tab.
    </para>
    <para>
     All attributes and values associated with this entry are displayed.
    </para>
    <figure id="fig.ldap.browsedata">
     <title>Browsing the Entry Data</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="ldap_y2_browsedata.png" width="85%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="ldap_y2_browsedata.png" width="85%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step performance="required">
    <para>
     To change the value of any of these attributes, select the attribute,
     click <guimenu>Edit</guimenu>, enter the new value, click
     <guimenu>Save</guimenu>, and provide the Root DN password when
     prompted.
    </para>
   </step>
   <step performance="required">
    <para>
     Leave the LDAP browser with <guimenu>Close</guimenu>.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="sec.security.ldap.slapd" os="sles;osuse">
  <title>Manually Configuring an LDAP Server</title><indexterm>

  <primary>LDAP</primary>

  <secondary>server configuration</secondary>

  <tertiary>manual</tertiary></indexterm><indexterm>

  <primary>configuration files</primary>

  <secondary>slapd.conf</secondary></indexterm>



  <para>
   YaST uses OpenLDAP's dynamic configuration database
   (<systemitem>back-config</systemitem>) to store the LDAP server's
   configuration. For details about the dynamic configuration backend please
   see the <systemitem>slapd-config(5)</systemitem> man page or the OpenLDAP
   Software 2.4 Administrator's Guide located at
   <filename>/usr/share/doc/packages/openldap2/guide/admin/guide.html</filename>
   on your system if the <systemitem>openldap2</systemitem> package is
   installed.
  </para>

  <tip>
   <title>Upgrading an Old OpenLDAP Installation</title>
   <para>
    YaST does not use <filename>/etc/openldap/slapd.conf</filename> to
    store the OpenLDAP configuration anymore. In case of a system upgrade, a
    copy of the original <filename>/etc/openldap/slapd.conf</filename> file
    will get created as
    <filename>/etc/openldap/slapd.conf.YaSTsave</filename>.
   </para>
  </tip>

  <para>
   To conveniently access the configuration backend, you use SASL external
   authentication. For example, the following <command>ldapsearch</command>
   command executed as <systemitem class="username">root</systemitem> can be used to show the
   complete <command>slapd</command> configuration:
  </para>

<screen>ldapsearch -Y external -H ldapi:/// -b cn=config</screen>



  <sect2 id="sec.security.ldap.slapd.start">
   <title>Starting and Stopping the Servers</title>
   <para>
    Once the LDAP server is fully configured and all desired entries have
    been made according to the pattern described in
    <xref linkend="sec.security.ldap.data"/>, start the LDAP server as
    <systemitem class="username">root</systemitem> by entering <command>rcldap <option>start</option></command>.
    To stop the server manually, enter the command <command>rcldap
    <option>stop</option></command>. Query the status of the running LDAP
    server with <command>rcldap <option>status</option></command>.
   </para>
   
  </sect2>
 </sect1>

 <sect1 id="sec.security.ldap.data" os="sles;osuse">
  <title>Manually Administering LDAP Data</title>

  <para>
   OpenLDAP offers a series of tools for the administration of data in the
   LDAP directory. The four most important tools for adding to, deleting
   from, searching through and modifying the data stock are explained in
   this section.
  </para>

  <sect2 id="sec.security.ldap.data.add">
   <title>Inserting Data into an LDAP Directory</title><indexterm>
   <primary>LDAP</primary>
   <secondary>adding data</secondary></indexterm><indexterm>
   <primary>LDAP</primary>
   <secondary>ldapadd</secondary></indexterm>
   <para>
    Once your LDAP server

    is correctly configured (it features appropriate entries for
    <literal>suffix</literal>, <literal>directory</literal>,
    <literal>rootdn</literal>, <literal>rootpw</literal> and
    <literal>index</literal>), proceed to entering records. OpenLDAP offers
    the <command>ldapadd</command> command for this task. If possible, add
    the objects to the database in bundles (for practical reasons). LDAP is
    able to process the LDIF format (LDAP data interchange format) for this.
    An LDIF file is a simple text file that can contain an arbitrary number
    of attribute and value pairs.

    The LDIF file for creating a rough framework for the example in
    <xref linkend="fig.ldap.tree"/> would look like the one in
    <xref linkend="dat.ldap.ldif"/>.
   </para>
   <important>
    <title>Encoding of LDIF Files</title>
    <para>

     LDAP works with UTF-8 (Unicode). Umlauts must be encoded correctly.
     Otherwise, avoid umlauts and other special characters or use
     <command>iconv</command> to convert the input to UTF-8.
    </para>
   </important>
   <example id="dat.ldap.ldif">
    <title>An LDIF File</title>
<screen># The Organization
dn: dc=example,dc=com
objectClass: dcObject
objectClass: organization
o: Example dc: example

# The organizational unit development (devel)
dn: ou=devel,dc=example,dc=com
objectClass: organizationalUnit
ou: devel

# The organizational unit documentation (doc)
dn: ou=doc,dc=example,dc=com
objectClass: organizationalUnit
ou: doc

# The organizational unit internal IT (it)
dn: ou=it,dc=example,dc=com
objectClass: organizationalUnit
ou: it</screen>
   </example>
   <para>
    Save the file with the <filename>.ldif</filename> suffix then pass it to
    the server with the following command:
   </para>
<screen>ldapadd -x -D <replaceable>dn_of_the_administrator</replaceable> -W -f <replaceable>file</replaceable>.ldif</screen><indexterm>
   <primary>commands</primary>
   <secondary>ldapadd</secondary></indexterm>
   <para>
    <literal>-x</literal> switches off the authentication with SASL in this
    case. <literal>-D</literal> declares the user that calls the operation.
    The valid DN of the administrator is entered here just like it has been
    configured in <filename>slapd.conf</filename>. In the current example,
    this is <literal>cn=Administrator,dc=example,dc=com</literal>.
    <literal>-W</literal> circumvents entering the password on the command
    line (in clear text) and activates a separate password prompt.

    The <literal>-f</literal> option passes the filename. See the details of
    running <command>ldapadd</command> in
    <xref linkend="aus.ldap.addentry"/>.
   </para>
   <example id="aus.ldap.addentry">
    <title>ldapadd with example.ldif</title>
<screen>ldapadd -x -D cn=Administrator,dc=example,dc=com -W -f example.ldif 

Enter LDAP password: 
adding new entry "dc=example,dc=com" 
adding new entry "ou=devel,dc=example,dc=com" 
adding new entry "ou=doc,dc=example,dc=com" 
adding new entry "ou=it,dc=example,dc=com"</screen>
   </example>
   <para>
    The user data of individuals can be prepared in separate LDIF files.
    <xref linkend="aus.ldap.addtux"/> adds
    <systemitem class="username">Tux</systemitem> to the new LDAP directory.
   </para>
   <example id="aus.ldap.addtux">
    <title>LDIF Data for Tux</title>
<screen># coworker Tux
dn: cn=Tux Linux,ou=devel,dc=example,dc=com
objectClass: inetOrgPerson
cn: Tux Linux
givenName: Tux
sn: Linux
mail: tux@example.com
uid: tux
telephoneNumber: +49 1234 567-8</screen>
   </example>
   <para>
    An LDIF file can contain an arbitrary number of objects. It is possible
    to pass directory branches (entirely or in part) to the server in one
    go, as shown in the example of individual objects. If it is necessary to
    modify some data relatively often, a fine subdivision of single objects
    is recommended.
   </para>
  </sect2>

  <sect2 id="sec.security.ldap.data.change">
   <title>Modifying Data in the LDAP Directory</title><indexterm>
   <primary>LDAP</primary>
   <secondary>modifying data</secondary></indexterm><indexterm>
   <primary>LDAP</primary>
   <secondary>ldapmodify</secondary></indexterm>
   <para>
    The tool <command>ldapmodify</command> is provided for modifying the
    data stock. The easiest way to do this is to modify the corresponding
    LDIF file and pass the modified file to the LDAP server. To change the
    telephone number of colleague <systemitem class="username">Tux</systemitem>
    from <literal>+49 1234 567-8</literal> to <literal>+49 1234 567-10</literal>,
    edit the LDIF file like in
    <xref linkend="aus.ldap.ldif.tux"/>.
   </para>
   <example id="aus.ldap.ldif.tux">
    <title>Modified LDIF File tux.ldif</title>
<screen># coworker Tux
dn: cn=Tux Linux,ou=devel,dc=example,dc=com 
changetype: modify
replace: telephoneNumber 
telephoneNumber: +49 1234 567-10</screen>
   </example>
   <para>
    Import the modified file into the LDAP directory with the following
    command:
   </para>
<screen>ldapmodify -x -D cn=Administrator,dc=example,dc=com -W -f tux.ldif</screen><indexterm>
   <primary>commands</primary>
   <secondary>ldapmodify</secondary></indexterm>
   <para>
    Alternatively, pass the attributes to change directly to
    <command>ldapmodify</command> as follows:
   </para>
   <procedure>
    <step performance="required">
     <para>
      Start <command>ldapmodify</command> and enter your password:
     </para>
<screen>ldapmodify -x -D cn=Administrator,dc=example,dc=com -W 
Enter LDAP password:</screen>
    </step>
    <step performance="required">
     <para>
      Enter the changes while carefully complying with the syntax in the
      order presented below:
     </para>
<screen>dn: cn=Tux Linux,ou=devel,dc=example,dc=com
changetype: modify
replace: telephoneNumber
telephoneNumber: +49 1234 567-10</screen>
    </step>
   </procedure>
   <para>
    For more information about <command>ldapmodify</command> and its syntax,
    see the <command>ldapmodify</command> man page.
   </para>
  </sect2>

  <sect2 id="sec.security.ldap.data.search">
   <title>Searching or Reading Data from an LDAP Directory</title><indexterm>
   <primary>LDAP</primary>
   <secondary>searching data</secondary></indexterm><indexterm>
   <primary>LDAP</primary>
   <secondary>ldapsearch</secondary></indexterm>
   <para>
    OpenLDAP provides, with <command>ldapsearch</command>, a command line
    tool for searching data within an LDAP directory and reading data from
    it. This is a simple query:
   </para>
<screen>ldapsearch -x -b dc=example,dc=com "(objectClass=*)"</screen><indexterm>
   <primary>commands</primary>
   <secondary>ldapsearch</secondary></indexterm>
   <para>
    The <option>-b</option> option determines the search base (the section
    of the tree within which the search should be performed). In the current
    case, this is <literal>dc=example,dc=com</literal>. To perform a more
    finely-grained search in specific subsections of the LDAP directory (for
    example, only within the <literal>devel</literal> department), pass this
    section to <command>ldapsearch</command> with <option>-b</option>.
    <option>-x</option> requests activation of simple authentication.
    <literal>(objectClass=*)</literal> declares that all objects contained
    in the directory should be read. This command option can be used after
    the creation of a new directory tree to verify that all entries have
    been recorded correctly and the server responds as desired. For more
    information about the use of <command>ldapsearch</command>, see the
    <systemitem>ldapsearch(1)</systemitem> man page.
   </para>
  </sect2>

  <sect2 id="sec.security.ldap.data.del">
   <title>Deleting Data from an LDAP Directory</title><indexterm>
   <primary>LDAP</primary>
   <secondary>deleting data</secondary></indexterm><indexterm>
   <primary>LDAP</primary>
   <secondary>ldapdelete</secondary></indexterm>
   <para>
    Delete unwanted entries with <command>ldapdelete</command>. The syntax
    is similar to that of the other commands. To delete, for example, the
    complete entry for <literal>Tux Linux</literal>, issue the following
    command:
   </para>
<screen>ldapdelete -x -D cn=Administrator,dc=example,dc=com -W cn=Tux \
Linux,ou=devel,dc=example,dc=com</screen><indexterm>
   <primary>commands</primary>
   <secondary>ldapdelete</secondary></indexterm>
  </sect2>
 </sect1>
 <sect1 id="sec.security.ldap.info">
  <title>For More Information</title>

  <para>
   More complex subjects (like SASL configuration or establishment of a
   replicating LDAP server that distributes the workload among multiple
   slaves) were omitted from this chapter. Find detailed information about
   both subjects in the <emphasis>OpenLDAP 2.4 Administrator's
   Guide</emphasis>—see at
   <xref linkend="list.ldap.info.adminguide"/>.
  </para>

  <para>
   The Web site of the OpenLDAP project offers exhaustive documentation for
   beginner and advanced LDAP users:
  </para>

  <variablelist>
   <varlistentry>
    <term>OpenLDAP Faq-O-Matic</term>
    <listitem>
     <para>
      A detailed question and answer collection applying to the
      installation, configuration, and use of OpenLDAP. Find it at
      <ulink url="http://www.openldap.org/faq/data/cache/1.html"/>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Quick Start Guide</term>
    <listitem>
     <para>
      Brief step-by-step instructions for installing your first LDAP server.
      Find it at
      <ulink url="http://www.openldap.org/doc/admin24/quickstart.html"/>
      or on an installed system in Section 2 of
      <filename>/usr/share/doc/packages/openldap2/guide/admin/guide.html</filename>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry id="list.ldap.info.adminguide">
    <term>OpenLDAP 2.4 Administrator's Guide</term>
    <listitem>
     <para>
      A detailed introduction to all important aspects of LDAP
      configuration, including access controls and encryption. See
      <ulink url="http://www.openldap.org/doc/admin24/"/> or, on an
      installed system,
      <filename>/usr/share/doc/packages/openldap2/guide/admin/guide.html</filename>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Understanding LDAP</term>
    <listitem>
     <para>
      A detailed general introduction to the basic principles of LDAP:
      <ulink url="http://www.redbooks.ibm.com/redbooks/pdfs/sg244986.pdf"/>.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   Printed literature about LDAP:
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     <citetitle>LDAP System Administration</citetitle> by Gerald Carter
     (ISBN 1-56592-491-6)
    </para>
   </listitem>
   <listitem>
    <para>
     <citetitle>Understanding and Deploying LDAP Directory
     Services</citetitle> by Howes, Smith, and Good (ISBN 0-672-32316-8)
    </para>
   </listitem>
  </itemizedlist>

  <para>
   The ultimate reference material for the subject of LDAP are the
   corresponding RFCs (request for comments), 2251 to 2256.
  </para><indexterm class="endofrange" startref="idx.LDAP"/>
 </sect1>
</chapter>
